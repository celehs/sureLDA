<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulated Example • sureLDA</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Simulated Example">
<meta property="og:description" content="sureLDA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sureLDA</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/example.html">Example</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://celehs.github.io">CELEHS Software</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Simulated Example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/celehs/sureLDA/blob/master/vignettes/example.Rmd"><code>vignettes/example.Rmd</code></a></small>
      <div class="hidden name"><code>example.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/celehs/sureLDA">sureLDA</a></span><span class="op">)</span></pre></div>
<pre><code>## Loading required package: Matrix</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://expasy.org/tools/pROC/">pROC</a></span><span class="op">)</span></pre></div>
<pre><code>## Type 'citation("pROC")' for a citation.</code></pre>
<pre><code>## 
## Attaching package: 'pROC'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     cov, smooth, var</code></pre>
<p>Let N denote the number of patients, W the number of EHR features, and K the number of target phenotypes to be predicted. Our input data consists of 1) X, an NxW matrix of EHR feature counts, 2) ICD, an NxK matrix of key ICD code counts for each target phenotype, 3) NLP, an NxK matrix of key NLP feature counts for each target phenotype, 4) HU, an N-dimensional vector of healthcare utilization measurements (i.e. total patient encounters in a patient’s chart), and 5) an NxK matrix of filter indicators for each target phenotype (we assume P(phenotype | filter=0) = 0).</p>
<p>First, we evaluate sureLDA with a PheNorm-generated prior (default) for prediction of 10 target phenotypes using a simulated dataset. We employ 10 ‘empty’ topics (this should generally be set in the range of 10-100).</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">surelda_run_phenorm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span>
  <span class="va">simdata</span>, <span class="fu"><a href="../reference/sureLDA.html">sureLDA</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">ICD</span>, <span class="va">NLP</span>, <span class="va">HU</span>, <span class="va">filter</span>, nEmpty <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="op">)</span></pre></div>
<pre><code>## [1] "Starting PheNorm"</code></pre>
<pre><code>## Warning in if (typeof(weight) == "character" &amp; weight == "uniform") {: the
## condition has length &gt; 1 and only the first element will be used</code></pre>
<pre><code>## [1] "Starting Guided LDA"
## [1] "Starting final clustering"</code></pre>
<p>Evaluating AUCs of sureLDA scores across 10 phenotypes</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="va">surelda_scores_phenorm_aucs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">$</span><span class="va">filter</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/auc.html">auc</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span>, <span class="va">k</span><span class="op">]</span>, <span class="va">surelda_run_phenorm</span><span class="op">$</span><span class="va">scores</span><span class="op">[</span>, <span class="va">k</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></pre></div>
<p>Evaluating AUCs of predicted probabilities across 10 phenotypes</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="va">surelda_ensemble_phenorm_aucs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">$</span><span class="va">filter</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/auc.html">auc</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span>, <span class="va">k</span><span class="op">]</span>, <span class="va">surelda_run_phenorm</span><span class="op">$</span><span class="va">ensemble</span><span class="op">[</span>, <span class="va">k</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></pre></div>
<p>AUCs:</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="va">surelda_result_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">surelda_scores_phenorm_aucs</span>, <span class="va">surelda_ensemble_phenorm_aucs</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">surelda_result_combined</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sureLDA Scores"</span>, <span class="st">"sureLDA Probs"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">surelda_result_combined</span><span class="op">)</span></pre></div>
<pre><code>##                     [,1]      [,2]      [,3]      [,4]      [,5]      [,6]
## sureLDA Scores 0.9111303 0.8685672 0.8728856 0.9111905 0.8777174 0.8555534
## sureLDA Probs  0.9122825 0.8636673 0.8718642 0.9083631 0.8750543 0.8614492
##                     [,7]      [,8]      [,9]     [,10]
## sureLDA Scores 0.9959016 0.7792440 0.8736038 0.9015808
## sureLDA Probs  0.9868511 0.7727148 0.8665491 0.8958076</code></pre>
<p>Next, we evaluate sureLDA’s predictions of the same 10 target phenotypes using the same data but given the prior and phi estimators from the previous run.</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="va">surelda_prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span>
  <span class="va">simdata</span>,
  <span class="fu"><a href="../reference/sureLDA.html">sureLDA</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">ICD</span>, <span class="va">NLP</span>, <span class="va">HU</span>, <span class="va">filter</span>,
    prior <span class="op">=</span> <span class="va">surelda_run_phenorm</span><span class="op">$</span><span class="va">prior</span>, nEmpty <span class="op">=</span> <span class="fl">10</span>,
    weight <span class="op">=</span> <span class="va">surelda_run_phenorm</span><span class="op">$</span><span class="va">weight</span>, phi <span class="op">=</span> <span class="va">surelda_run_phenorm</span><span class="op">$</span><span class="va">phi</span>
  <span class="op">)</span>
<span class="op">)</span></pre></div>
<pre><code>## Warning in if (typeof(weight) == "character" &amp; weight == "uniform") {: the
## condition has length &gt; 1 and only the first element will be used</code></pre>
<pre><code>## [1] "Inferring theta given provided phi"
## [1] "Starting final clustering"</code></pre>
<p>Evaluating AUCs of sureLDA scores across 10 phenotypes</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="va">surelda_scores_prediction_aucs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">$</span><span class="va">filter</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/auc.html">auc</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span>, <span class="va">k</span><span class="op">]</span>, <span class="va">surelda_prediction</span><span class="op">$</span><span class="va">scores</span><span class="op">[</span>, <span class="va">k</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></pre></div>
<p>Evaluating AUCs of predicted probabilities across 10 phenotypes</p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="va">surelda_ensemble_prediction_aucs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">$</span><span class="va">filter</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/auc.html">auc</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span>, <span class="va">k</span><span class="op">]</span>, <span class="va">surelda_prediction</span><span class="op">$</span><span class="va">ensemble</span><span class="op">[</span>, <span class="va">k</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></pre></div>
<p>AUCs:</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="va">surelda_prediction_result_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">surelda_scores_prediction_aucs</span>, <span class="va">surelda_ensemble_prediction_aucs</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">surelda_prediction_result_combined</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sureLDA Scores"</span>, <span class="st">"sureLDA Probs"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">surelda_prediction_result_combined</span><span class="op">)</span></pre></div>
<pre><code>##                     [,1]      [,2]      [,3]      [,4]      [,5]      [,6]
## sureLDA Scores 0.9117572 0.8666806 0.8697857 0.9115774 0.8727717 0.8669646
## sureLDA Probs  0.9132991 0.8660256 0.8711833 0.9123810 0.8750543 0.8674401
##                     [,7]      [,8]      [,9]     [,10]
## sureLDA Scores 0.9959016 0.7758763 0.8684597 0.9014433
## sureLDA Probs  0.9880464 0.7758763 0.8666961 0.8956701</code></pre>
<p>Total time spent:</p>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/proc.time.html">proc.time</a></span><span class="op">(</span><span class="op">)</span></pre></div>
<pre><code>##    user  system elapsed 
##  82.091   0.487  82.708</code></pre>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Yuri Ahuja, Tianxi Cai,  PARSE LTD.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
